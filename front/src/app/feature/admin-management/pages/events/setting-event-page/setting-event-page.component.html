<app-navbar-event-page
  [eventUrl]="eventUrl"
  [eventId]="eventId"
  [eventName]="eventName"
  [teamUrl]="teamUrl">
</app-navbar-event-page>

<div class="px-10 sm:px-10 md:px-10 lg:px-10 xl:px-20 2xl:px-70 w-full">
  <main class="flex">
    <app-sidebar-event [eventId]="eventId"></app-sidebar-event>
    <section class="flex-1 p-4">
      @if (isLoading) {
        <div class="flex justify-center items-center h-40" role="status" aria-label="Loading event data">
          <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
          <span class="sr-only">Loading...</span>
        </div>
      }

      @if (error) {
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
          <p>{{ error }}</p>
        </div>
      }

      @if (!isLoading && !error) {
        <article class="w-full items-center bg-white shadow-md rounded-lg mb-5">
          <header class="p-4">
            <h1 class="text-xl font-medium">General</h1>
            <p class="mt-2 text-sm text-gray-600">
              Change event name, URL, and visibility settings
            </p>
          </header>

          <div class="px-4 pb-4">
            <app-general-info-event
              mode="edit"
              [initialData]="eventGeneralData"
              [initialVisibility]="visibility"
              (formSubmitted)="onGeneralFormSubmitted($event)">
            </app-general-info-event>
          </div>
        </article>

        <app-information-event
          mode="edit"
          [initialData]="eventInformationData"
          (formSubmitted)="onInformationFormSubmitted($event)">
        </app-information-event>

        @if (currentUserRole === 'Owner') {
          <article class="w-full items-center bg-white shadow-md border-2 border-red-300 rounded-lg mt-5">
            <header class="p-4">
              <h2 class="text-xl font-medium text-red-600">Danger Zone</h2>
              <p class="mt-2 text-sm text-gray-600">
                Irreversible and destructive actions
              </p>
            </header>

            <hr class="border-red-200">

            <footer class="p-4">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="text-lg font-medium text-gray-900">Delete this event</h3>
                  <p class="text-sm text-gray-600">
                    Once you delete an event, there is no going back. Please be certain.
                  </p>
                </div>
                <button
                  type="button"
                  (click)="confirmDeleteEvent()"
                  class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md cursor-pointer transition-colors"
                  [attr.aria-label]="'Delete event: ' + eventName">
                  Delete event
                </button>
              </div>
            </footer>
          </article>
        }
      }

      <app-delete-event-popup
        [eventName]="eventName"
        [isOpen]="showDeleteConfirmation"
        [isDeleting]="isDeleting"
        (confirm)="deleteEvent()"
        (cancel)="cancelDeleteEvent()">
      </app-delete-event-popup>
    </section>
  </main>
</div>
