<article class="w-full flex-grow bg-white shadow-xs rounded-lg p-5">
  @if (showAutoSaveIndicator) {
    <app-save-indicator
      [status]="saveStatus$ | async"
      position="bottom-right">
    </app-save-indicator>
  }

  <form [formGroup]="form" (ngSubmit)="onSubmit()">

    @for(field of formFields; track field.name) {
      <div class="mb-4">
        @if(getFormControl(field.name).hasError('required') && isSubmitted) {
          <p class="text-red-500 text-sm mt-1"
             [attr.aria-describedby]="field.name + '-error'"
             role="alert">
            This field is required
          </p>
        }
        @if((field.name === 'name' || field.name === 'eventName') && getFormControl(field.name).hasError('minlength') && isSubmitted) {
          <p class="text-red-500 text-sm mt-1" role="alert">
            Name must be at least 2 characters long
          </p>
        }
        @if((field.name === 'name' || field.name === 'eventName') && getFormControl(field.name).hasError('maxlength') && isSubmitted) {
          <p class="text-red-500 text-sm mt-1" role="alert">
            Name must not exceed 50 characters
          </p>
        }

        <app-input
          [label]="field.label"
          [placeholder]="field.placeholder"
          [paragraph]="field.paragraph"
          [type]="field.type"
          [control]="getFormControl(field.name)"
          [name]="field.name"
          [required]="field.required"
          [options]="field.options || []"
          [disabled]="field.disabled"
          [attr.aria-invalid]="getFormControl(field.name).invalid && isSubmitted">
        </app-input>
      </div>
    }

    @if (showVisibilitySection) {
      <section class="mt-5">
        <label class="block text-start text-md font-medium text-gray-700 mb-3">Visibility</label>
        <div class="mt-3 bg-gray-50 rounded-lg">

          <div class="bg-white rounded-lg overflow-hidden shadow-sm ring-1 ring-gray-200">

            <label  class="relative p-4 flex cursor-pointer transition-all duration-200 ease-in-out group"
              [ngClass]="{ 'bg-blue-50': visibility === 'private', 'bg-white hover:bg-gray-50': visibility !== 'private' }">

              <div class="flex items-center h-5">
                <input
                  id="visibility-private"
                  name="visibility"
                  type="radio"
                  formControlName="visibility"
                  value="private"
                  class="sr-only"
                  [attr.aria-describedby]="'visibility-private-description'"/>

                <div class="w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all duration-200"
                  [ngClass]="{ 'border-blue-500 bg-blue-500 shadow-sm': visibility === 'private', 'border-gray-300 bg-white group-hover:border-blue-300': visibility !== 'private' }">
                  <div class="w-2 h-2 rounded-full bg-white transition-all duration-200"
                    [ngClass]="{ 'opacity-100 scale-100': visibility === 'private', 'opacity-0 scale-75': visibility !== 'private' }">
                  </div>
                </div>
              </div>

              <div class="ml-4 flex-1">
                <span class="block text-sm font-medium transition-colors duration-200"
                      [ngClass]="{ 'text-blue-900': visibility === 'private', 'text-gray-900': visibility !== 'private' }">
                  Private
                </span>
                <span id="visibility-private-description" class="block text-sm transition-colors duration-200"
                      [ngClass]="{ 'text-blue-700': visibility === 'private', 'text-gray-600': visibility !== 'private' }">
                  This event would be available to anyone who has the link.
                </span>
              </div>
            </label>

            <label
              class="relative p-4 flex cursor-pointer transition-all duration-200 ease-in-out group"
              [ngClass]="{ 'bg-blue-50': visibility === 'public', 'bg-white hover:bg-gray-50': visibility !== 'public' }">

              <div class="flex items-center h-5">
                <input
                  id="visibility-public"
                  name="visibility"
                  type="radio"
                  formControlName="visibility"
                  value="public"
                  class="sr-only"
                  [attr.aria-describedby]="'visibility-public-description'"/>

                <div
                  class="w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all duration-200"
                  [ngClass]="{ 'border-blue-500 bg-blue-500 shadow-sm': visibility === 'public', 'border-gray-300 bg-white group-hover:border-blue-300': visibility !== 'public' }">

                  <div
                    class="w-2 h-2 rounded-full bg-white transition-all duration-200"
                    [ngClass]="{ 'opacity-100 scale-100': visibility === 'public', 'opacity-0 scale-75': visibility !== 'public' }">
                  </div>
                </div>
              </div>

              <div class="ml-4 flex-1">
                <span class="block text-sm font-medium transition-colors duration-200"
                  [ngClass]="{ 'text-blue-900': visibility === 'public', 'text-gray-900': visibility !== 'public' }">
                  Public
                </span>
                <span id="visibility-public-description" class="block text-sm transition-colors duration-200"
                  [ngClass]="{ 'text-blue-700': visibility === 'public', 'text-gray-600': visibility !== 'public' }">
                    This event will be available in the Speaker Space search and visible to anyone.
                </span>
              </div>
            </label>
          </div>
        </div>
      </section>
    }

    <div class="mt-20 mb-6">
      <label for="timezone-selector" class="block text-start text-md font-medium text-gray-700">
        Event timezone
      </label>
      <div class="relative mt-2">
        <select
          id="timezone-selector"
          [formControl]="timezoneSelector"
          class="block w-full rounded-md bg-white px-3 py-2.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-gray-600 sm:text-sm/6 resize-none"
          [attr.aria-describedby]="'timezone-description'">
          @for(tz of timezoneOptions; track tz.name) {
            <option [value]="tz.name">
              {{ formatTimezoneOption(tz) }}
            </option>
          }
        </select>
        <p id="timezone-description" class="sr-only">
          Select the timezone for your event
        </p>
      </div>
    </div>

    @if (showGoBackButton) {
      <hr class="mt-6 rounded-lg w-[100%] mx-auto border-gray-200">

      <div class="flex justify-end p-4">
          <app-button-grey
            type="button"
            (click)="onGoBack()"
            customTextClass="text-gray-600 hover:text-gray-600"
            class="rounded-md mr-5 text-sm inline-flex items-center gap-2 bg-white hover:bg-gray-100 border border-gray-300 cursor-pointer shadow-sm">
            Go back
          </app-button-grey>

          <app-button-green-actions
            [type]="'submit'"
            [materialIcon]="submitButtonIcon">
            {{ submitButtonText }}
          </app-button-green-actions>

      </div>
    }
  </form>
</article>
